{{ 'component-collection-list.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign columns = section.settings.columns
  assign image_ratio = section.settings.image_ratio
-%}

<section
  class="section collection-list color-scheme-{{ color_scheme }}"
  data-section-id="{{ section.id }}"
  {% render 'util-section-spacing', padding_top: section.settings.padding_top, padding_bottom: section.settings.padding_bottom %}
>
  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <div class="section__header text-center">
        <h2 class="section__title" {% render 'util-animation', animation: 'fade-up' %}>{{ section.settings.title }}</h2>
        {%- if section.settings.subtitle != blank -%}
          <p class="section__subtitle" {% render 'util-animation', animation: 'fade-up', index: 2 %}>{{ section.settings.subtitle }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="grid grid--{{ columns }}" data-animate-stagger>
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = collections[block.settings.collection]
        -%}
        <div {{ block.shopify_attributes }} {% render 'util-animation', animation: 'fade-up', index: forloop.index %}>
          <a href="{{ collection.url | default: '#' }}" class="collection-card">
            <div class="collection-card__media collection-card__media--{{ image_ratio }}">
              {%- if block.settings.image != blank -%}
                {%- render 'util-responsive-image',
                  image: block.settings.image,
                  widths: '300,400,600,800',
                  sizes: '(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw',
                  loading: 'lazy'
                -%}
              {%- elsif collection.image -%}
                {%- render 'util-responsive-image',
                  image: collection.image,
                  widths: '300,400,600,800',
                  sizes: '(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw',
                  loading: 'lazy'
                -%}
              {%- else -%}
                {{ 'collection-' | append: forloop.index | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            </div>
            <div class="collection-card__info">
              <h3 class="collection-card__title">
                {{ block.settings.title | default: collection.title | default: 'Collection' }}
              </h3>
              {%- if section.settings.show_count and collection != blank -%}
                <p class="collection-card__count">{{ collection.products_count }} {{ 'general.products' | t | default: 'products' }}</p>
              {%- endif -%}
            </div>
          </a>
        </div>
      {%- endfor -%}

      {%- if section.blocks.size == 0 -%}
        {%- for i in (1..columns) -%}
          <div>
            <div class="collection-card">
              <div class="collection-card__media collection-card__media--{{ image_ratio }}">
                <div class="skeleton skeleton--image"></div>
              </div>
              <div class="collection-card__info">
                <div class="skeleton skeleton--title"></div>
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Collection list",
  "class": "collection-list-section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "Collections" },
    { "type": "text", "id": "subtitle", "label": "Subtitle" },
    {
      "type": "select", "id": "columns", "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" }
      ],
      "default": "3"
    },
    {
      "type": "select", "id": "image_ratio", "label": "Image ratio",
      "options": [
        { "value": "square", "label": "Square" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "landscape", "label": "Landscape" },
        { "value": "circle", "label": "Circle" }
      ],
      "default": "square"
    },
    { "type": "checkbox", "id": "show_count", "label": "Show product count", "default": true },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "image_picker", "id": "image", "label": "Custom image" },
        { "type": "text", "id": "title", "label": "Custom title" }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Collection list",
      "blocks": [
        { "type": "collection" },
        { "type": "collection" },
        { "type": "collection" }
      ]
    }
  ]
}
{% endschema %}
