{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign max_products = section.settings.max_products | default: 3
-%}

{{ 'component-bought-together.css' | asset_url | stylesheet_tag }}

<section
  class="section bought-together color-scheme-{{ color_scheme }}"
  data-section-id="{{ section.id }}"
  {% render 'util-section-spacing', padding_top: section.settings.padding_top, padding_bottom: section.settings.padding_bottom %}
>
  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <h2 class="section-header__title">{{ section.settings.title }}</h2>
    {%- endif -%}

    <bought-together
      class="bought-together__container"
      data-product-id="{{ product.id }}"
      data-url="{{ routes.product_recommendations_url }}?product_id={{ product.id }}&intent=complementary&limit={{ max_products }}"
      data-max="{{ max_products }}"
    >
      <div class="bought-together__products" data-products>
        {%- comment -%}Current product (always shown){%- endcomment -%}
        <div class="bought-together__item" data-item data-variant-id="{{ product.selected_or_first_available_variant.id }}" data-price="{{ product.selected_or_first_available_variant.price }}">
          <label class="bought-together__checkbox">
            <input type="checkbox" checked disabled>
            <span class="bought-together__check-mark">{%- render 'util-icon', icon: 'check', size: 14 -%}</span>
          </label>
          <div class="bought-together__image">
            {%- if product.featured_image != blank -%}
              <img
                src="{{ product.featured_image | image_url: width: 200 }}"
                alt="{{ product.featured_image.alt | default: product.title | escape }}"
                width="100"
                height="100"
                loading="lazy"
              >
            {%- endif -%}
          </div>
          <div class="bought-together__info">
            <p class="bought-together__title">{{ product.title | truncate: 40 }}</p>
            <p class="bought-together__price">{{ product.selected_or_first_available_variant.price | money }}</p>
          </div>
        </div>
      </div>

      <div class="bought-together__summary" data-summary>
        <div class="bought-together__total">
          <span class="bought-together__total-label">{{ 'general.product.total_price' | t | default: 'Total price' }}:</span>
          <span class="bought-together__total-price" data-total-price>{{ product.selected_or_first_available_variant.price | money }}</span>
        </div>
        <button type="button" class="btn btn--primary btn--lg bought-together__add-all" data-add-all>
          {%- render 'util-icon', icon: 'cart', size: 18 -%}
          {{ 'general.product.add_all_to_cart' | t | default: 'Add all to cart' }}
        </button>
      </div>
    </bought-together>
  </div>
</section>

<script src="{{ 'component-bought-together.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Frequently bought together",
  "class": "bought-together-section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "Frequently Bought Together" },
    { "type": "range", "id": "max_products", "label": "Max products to show", "min": 2, "max": 4, "step": 1, "default": 3 },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" }
  ],
  "presets": [
    {
      "name": "Frequently bought together"
    }
  ],
  "templates": ["product"]
}
{% endschema %}
