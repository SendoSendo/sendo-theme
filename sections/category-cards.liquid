{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign columns = section.settings.columns | default: 4
-%}

{{ 'component-category-cards.css' | asset_url | stylesheet_tag }}

<section
  class="section category-cards color-scheme-{{ color_scheme }}"
  data-section-id="{{ section.id }}"
  {% render 'util-section-spacing', padding_top: section.settings.padding_top, padding_bottom: section.settings.padding_bottom %}
>
  <div class="page-width">
    {%- if section.settings.title != blank or section.settings.subtitle != blank -%}
      <div class="section-header">
        {%- if section.settings.title != blank -%}
          <h2 class="section-header__title">{{ section.settings.title }}</h2>
        {%- endif -%}
        {%- if section.settings.subtitle != blank -%}
          <p class="section-header__subtitle">{{ section.settings.subtitle }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="category-cards__grid grid grid--{{ columns }}">
        {%- for block in section.blocks -%}
          {%- liquid
            assign collection = collections[block.settings.collection]
            assign card_image = block.settings.image | default: collection.image
            assign card_title = block.settings.heading | default: collection.title
            assign card_url = collection.url | default: '#'
          -%}

          <a
            href="{{ card_url }}"
            class="category-card{% if section.settings.card_style == 'overlay_text' %} category-card--overlay{% endif %}"
            {{ block.shopify_attributes }}
            {% render 'util-animation', animation: 'fade-up', index: forloop.index %}
          >
            <div class="category-card__image">
              {%- if card_image != blank -%}
                {%- render 'util-responsive-image',
                  image: card_image,
                  widths: '200,300,400,600',
                  sizes: '(min-width: 990px) 25vw, 50vw',
                  loading: 'lazy',
                  aspect_ratio: '1/1'
                -%}
              {%- else -%}
                <div class="category-card__placeholder">
                  {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
                </div>
              {%- endif -%}
            </div>
            {%- if card_title != blank -%}
              <div class="category-card__content">
                <h3 class="category-card__title">{{ card_title }}</h3>
                <span class="category-card__cta">
                  {{ 'general.collection.shop_now' | t | default: 'Shop now' }}
                  {%- render 'util-icon', icon: 'arrow-right', size: 14 -%}
                </span>
              </div>
            {%- endif -%}
          </a>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Category cards",
  "class": "category-cards-section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "Shop by Category" },
    { "type": "text", "id": "subtitle", "label": "Subtitle" },
    {
      "type": "select", "id": "columns", "label": "Columns",
      "options": [
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" },
        { "value": "6", "label": "6" }
      ],
      "default": "4"
    },
    {
      "type": "select", "id": "card_style", "label": "Card style",
      "options": [
        { "value": "below_text", "label": "Text below image" },
        { "value": "overlay_text", "label": "Text overlay on image" }
      ],
      "default": "below_text"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" }
  ],
  "blocks": [
    {
      "type": "category_card",
      "name": "Category card",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection" },
        { "type": "image_picker", "id": "image", "label": "Custom image", "info": "Overrides collection image" },
        { "type": "text", "id": "heading", "label": "Custom heading", "info": "Overrides collection title" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Category cards",
      "blocks": [
        { "type": "category_card" },
        { "type": "category_card" },
        { "type": "category_card" },
        { "type": "category_card" }
      ]
    }
  ]
}
{% endschema %}
