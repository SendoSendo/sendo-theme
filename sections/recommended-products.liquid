{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-badge.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign limit = section.settings.products_to_show
-%}

<section
  class="section recommended-products color-scheme-{{ color_scheme }}"
  data-section-id="{{ section.id }}"
  {% render 'util-section-spacing', padding_top: section.settings.padding_top, padding_bottom: section.settings.padding_bottom %}
>
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <div class="section__header text-center">
        <h2 class="section__title" {% render 'util-animation', animation: 'fade-up' %}>{{ section.settings.heading }}</h2>
      </div>
    {%- endif -%}

    <div id="RecommendedProducts-{{ section.id }}" data-product-recommendations data-url="{{ routes.product_recommendations_url }}?product_id={{ product.id }}&limit={{ limit }}&section_id={{ section.id }}">
      {%- if recommendations.performed and recommendations.products_count > 0 -%}
        <div class="grid grid--{{ section.settings.columns }}" data-animate-stagger>
          {%- for product in recommendations.products -%}
            <div {% render 'util-animation', animation: 'fade-up', index: forloop.index %}>
              {%- render 'product-card', product: product, lazy: true -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<script src="{{ 'component-product-recommendations.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Recommended products",
  "class": "recommended-products-section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "You may also like" },
    { "type": "range", "id": "products_to_show", "label": "Products to show", "min": 2, "max": 10, "step": 1, "default": 4 },
    {
      "type": "select", "id": "columns", "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" }
      ],
      "default": "4"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 60, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 60, "unit": "px" }
  ]
}
{% endschema %}
