{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-badge.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign limit = section.settings.products_to_show
  assign columns = section.settings.columns
  assign color_scheme = section.settings.color_scheme
  assign layout = section.settings.layout
-%}

<section
  class="section featured-collection color-scheme-{{ color_scheme }}"
  data-section-id="{{ section.id }}"
  {% render 'util-section-spacing', padding_top: section.settings.padding_top, padding_bottom: section.settings.padding_bottom %}
>
  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <div class="section__header{% if section.settings.show_view_all %} flex flex--between flex--center{% endif %}">
        <div>
          <h2 class="section__title" {% render 'util-animation', animation: 'fade-up' %}>{{ section.settings.title }}</h2>
          {%- if section.settings.subtitle != blank -%}
            <p class="section__subtitle" {% render 'util-animation', animation: 'fade-up', index: 2 %}>{{ section.settings.subtitle }}</p>
          {%- endif -%}
        </div>
        {%- if section.settings.show_view_all and collection != blank -%}
          <a href="{{ collection.url }}" class="btn btn--tertiary hide-mobile">
            {{ 'general.view_all' | t | default: 'View all' }}
            {%- render 'util-icon', icon: 'arrow-right', size: 16 -%}
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if collection != blank -%}
      {%- if layout == 'slider' -%}
        <slider-component>
          <div class="slider__track slider--{{ columns }}" data-slider-track data-animate-stagger>
            {%- for product in collection.products limit: limit -%}
              <div class="slider__slide" {% render 'util-animation', animation: 'fade-up', index: forloop.index %}>
                {%- render 'product-card', product: product, lazy: true -%}
              </div>
            {%- endfor -%}
          </div>
          {%- if collection.products.size > columns -%}
            <button class="slider__nav slider__nav--prev" data-slider-prev aria-label="{{ 'accessibility.previous' | t | default: 'Previous' }}">
              {%- render 'util-icon', icon: 'chevron-left', size: 16 -%}
            </button>
            <button class="slider__nav slider__nav--next" data-slider-next aria-label="{{ 'accessibility.next' | t | default: 'Next' }}">
              {%- render 'util-icon', icon: 'chevron-right', size: 16 -%}
            </button>
          {%- endif -%}
        </slider-component>
        <script src="{{ 'component-slider.js' | asset_url }}" defer></script>
      {%- else -%}
        <div class="grid grid--{{ columns }}" data-animate-stagger>
          {%- for product in collection.products limit: limit -%}
            <div {% render 'util-animation', animation: 'fade-up', index: forloop.index %}>
              {%- render 'product-card', product: product, lazy: true -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    {%- else -%}
      <div class="grid grid--{{ columns }}">
        {%- for i in (1..limit) -%}
          <div class="card">
            <div class="card__media skeleton skeleton--image"></div>
            <div class="card__content">
              <div class="skeleton skeleton--title"></div>
              <div class="skeleton skeleton--text"></div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if section.settings.show_view_all and collection != blank -%}
      <div class="text-center mt-lg hide-above-mobile">
        <a href="{{ collection.url }}" class="btn btn--secondary">
          {{ 'general.view_all' | t | default: 'View all' }}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Featured collection",
  "class": "featured-collection-section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "Featured Products" },
    { "type": "text", "id": "subtitle", "label": "Subtitle" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "products_to_show", "label": "Products to show", "min": 2, "max": 12, "step": 1, "default": 4 },
    {
      "type": "select", "id": "columns", "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" }
      ],
      "default": "4"
    },
    {
      "type": "select", "id": "layout", "label": "Layout",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "slider", "label": "Slider" }
      ],
      "default": "grid"
    },
    { "type": "checkbox", "id": "show_view_all", "label": "Show 'View all' button", "default": true },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" }
  ],
  "presets": [{ "name": "Featured collection" }]
}
{% endschema %}
